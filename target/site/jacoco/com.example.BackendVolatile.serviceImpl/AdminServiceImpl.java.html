<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">com.example.BackendVolatile.serviceImpl</a> &gt; <span class="el_source">AdminServiceImpl.java</span></div><h1>AdminServiceImpl.java</h1><pre class="source lang-java linenums">package com.example.BackendVolatile.serviceImpl;

import com.example.BackendVolatile.dao.taskDAO.ExecutableFile;
import com.example.BackendVolatile.dao.taskDAO.RequirementDescriptionFile;
import com.example.BackendVolatile.dao.taskDAO.Task;
import com.example.BackendVolatile.dto.adminDTO.BrowserTaskDetailDTO;
import com.example.BackendVolatile.dto.adminDTO.SetAlgorithmDTO;
import com.example.BackendVolatile.dto.adminDTO.SetChangeablePeriodDTO;
import com.example.BackendVolatile.dto.adminDTO.SetRecommendRuleDTO;
import com.example.BackendVolatile.mapper.report.AlgorithmMapper;
import com.example.BackendVolatile.mapper.report.RecommendationRuleMapper;
import com.example.BackendVolatile.mapper.task.ExecutableFileMapper;
import com.example.BackendVolatile.mapper.task.RequirementDescriptionFileMapper;
import com.example.BackendVolatile.mapper.task.TaskMapper;
import com.example.BackendVolatile.service.AdminService;
import com.example.BackendVolatile.util.ParameterValidityVerification;
import com.example.BackendVolatile.util.constant.*;
import com.example.BackendVolatile.vo.adminVO.*;
import com.example.BackendVolatile.vo.ResultVO;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.ExceptionHandler;

import javax.annotation.Resource;
import java.util.List;
import java.util.Map;

@Service
<span class="fc" id="L28">public class AdminServiceImpl implements AdminService {</span>

    @Resource
    TaskMapper taskMapper;

    @Resource
    ParameterValidityVerification parameterValidityVerification;

    @Resource
    ExecutableFileMapper executableFileMapper;

    @Resource
    RequirementDescriptionFileMapper requirementDescriptionFileMapper;

    @Resource
    AlgorithmMapper algorithmMapper;

    @Resource
    RecommendationRuleMapper recommendationRuleMapper;


    /**
     * 调用者：admin
     * 业务逻辑：管理员查看系统所有任务
     * @return
     */
    @Override
    public BrowserAllTasksVO browserAllTasks(){
<span class="nc" id="L56">        BrowserAllTasksVO browserAllTasksVO = new BrowserAllTasksVO();</span>

<span class="nc" id="L58">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L59">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L60">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L61">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L63" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L64">            browserAllTasksVO.setResponse(resultVO);</span>
<span class="nc" id="L65">            return browserAllTasksVO;</span>
        }

<span class="nc" id="L68">        List&lt;Task&gt; taskList = taskMapper.get_all_without_paging();</span>
<span class="nc" id="L69">        browserAllTasksVO.setTaskList(taskList);</span>
<span class="nc" id="L70">        browserAllTasksVO.setResponse(new ResultVO(ResponseConstant.REQUEST_DATA_SUCCEEDED));</span>
<span class="nc" id="L71">        return browserAllTasksVO;</span>
    }

    /**
     * 调用者：admin
     * 业务逻辑：管理员在个人中心查看任务细节
     * @param browserTaskDetailDTO
     * @return
     */
    @Override
    public BrowserTaskDetailVO browserTaskDetail(BrowserTaskDetailDTO browserTaskDetailDTO){
<span class="nc" id="L82">        BrowserTaskDetailVO browserTaskDetailVO = new BrowserTaskDetailVO();</span>
<span class="nc" id="L83">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L84">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L85">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L86">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L88" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L89">            browserTaskDetailVO.setResponse(resultVO);</span>
<span class="nc" id="L90">            return browserTaskDetailVO;</span>
        }

<span class="nc" id="L93">        Long taskId = browserTaskDetailDTO.getTaskId();</span>
<span class="nc" id="L94">        Task task = taskMapper.get_by_task_id(taskId);</span>
<span class="nc" id="L95">        browserTaskDetailVO.setTaskPartDetail(task);</span>

<span class="nc" id="L97">        List&lt;ExecutableFile&gt; executableFileList =</span>
<span class="nc" id="L98">                executableFileMapper.get_all_by_task_id_without_paging(taskId);</span>
<span class="nc" id="L99">        browserTaskDetailVO.setExecutableFileList(executableFileList);</span>

<span class="nc" id="L101">        List&lt;RequirementDescriptionFile&gt; requirementDescriptionFileList =</span>
<span class="nc" id="L102">                requirementDescriptionFileMapper.get_all_by_task_id_without_paging(taskId);</span>
<span class="nc" id="L103">        browserTaskDetailVO.setRequirementDescriptionFileList(requirementDescriptionFileList);</span>

<span class="nc" id="L105">        browserTaskDetailVO.setResponse(new ResultVO(ResponseConstant.EMPLOYER_SUCCEEDED));</span>
<span class="nc" id="L106">        return browserTaskDetailVO;</span>
    }


    /**
     * 管理员设置任务推荐规则
     * @param setRecommendRuleDTO
     * @return
     */
    @Override
    public SetRecommendRuleVO setRecommendRule(SetRecommendRuleDTO setRecommendRuleDTO){
<span class="nc" id="L117">        SetRecommendRuleVO setRecommendRuleVO = new SetRecommendRuleVO();</span>
<span class="nc" id="L118">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L119">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L120">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L121">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L123" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L124">            setRecommendRuleVO.setResponse(resultVO);</span>
<span class="nc" id="L125">            return setRecommendRuleVO;</span>
        }
<span class="nc" id="L127">        recommendationRuleMapper.delete_all();</span>
<span class="nc" id="L128">        List&lt;String&gt; eu = setRecommendRuleDTO.getEmphasized_user_features();</span>
<span class="nc" id="L129">        List&lt;String&gt; du = setRecommendRuleDTO.getDesalted_user_features();</span>
<span class="nc" id="L130">        List&lt;String&gt; et = setRecommendRuleDTO.getEmphasized_task_features();</span>
<span class="nc" id="L131">        List&lt;String&gt; dt = setRecommendRuleDTO.getDesalted_task_features();</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">        for(int i = 0; i &lt; eu.size();i++){</span>
<span class="nc" id="L134">            recommendationRuleMapper.insert(eu.get(i), RecommendationRuleClassificationConstant.EMPHASIZED_USER_FEATURES);</span>
        }
<span class="nc bnc" id="L136" title="All 2 branches missed.">        for(int i = 0; i &lt; du.size();i++){</span>
<span class="nc" id="L137">            recommendationRuleMapper.insert(du.get(i), RecommendationRuleClassificationConstant.DESALTED_USER_FEATURES);</span>
        }
<span class="nc bnc" id="L139" title="All 2 branches missed.">        for(int i = 0; i &lt; et.size();i++){</span>
<span class="nc" id="L140">            recommendationRuleMapper.insert(et.get(i), RecommendationRuleClassificationConstant.EMPHASIZED_TASK_FEATURES);</span>
        }
<span class="nc bnc" id="L142" title="All 2 branches missed.">        for(int i = 0; i &lt; dt.size();i++){</span>
<span class="nc" id="L143">            recommendationRuleMapper.insert(dt.get(i), RecommendationRuleClassificationConstant.DESALTED_TASK_FEATURES);</span>
        }
<span class="nc" id="L145">        setRecommendRuleVO.setResponse(new ResultVO(ResponseConstant.ADMIN_SET_RECOMMENDATION_RULE_SUCCESS));</span>
<span class="nc" id="L146">        return setRecommendRuleVO;</span>
    }

    /**
     * 管理员获取任务推荐规则
     * @return
     */
    @Override
    public GetRecommendRuleVO getRecommendRule(){
<span class="nc" id="L155">        GetRecommendRuleVO getRecommendRuleVO = new GetRecommendRuleVO();</span>
<span class="nc" id="L156">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L157">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L158">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L159">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L161" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L162">            getRecommendRuleVO.setResponse(resultVO);</span>
<span class="nc" id="L163">            return getRecommendRuleVO;</span>
        }

<span class="nc bnc" id="L166" title="All 2 branches missed.">        System.out.println(recommendationRuleMapper.get_feature_by_classification(</span>
                RecommendationRuleClassificationConstant.EMPHASIZED_USER_FEATURES) == null);
<span class="nc" id="L168">        getRecommendRuleVO.setEmphasizedUserFeatures(recommendationRuleMapper.get_feature_by_classification(</span>
                RecommendationRuleClassificationConstant.EMPHASIZED_USER_FEATURES));

<span class="nc" id="L171">        getRecommendRuleVO.setDesaltedUserFeatures(recommendationRuleMapper.get_feature_by_classification(</span>
                RecommendationRuleClassificationConstant.DESALTED_USER_FEATURES));

<span class="nc" id="L174">        getRecommendRuleVO.setEmphasizedTaskFeatures(recommendationRuleMapper.get_feature_by_classification(</span>
                RecommendationRuleClassificationConstant.EMPHASIZED_TASK_FEATURES));

<span class="nc" id="L177">        getRecommendRuleVO.setDesaltedTaskFeatures(recommendationRuleMapper.get_feature_by_classification(</span>
                RecommendationRuleClassificationConstant.DESALTED_TASK_FEATURES));

<span class="nc" id="L180">        getRecommendRuleVO.setResponse(new ResultVO(ResponseConstant.REQUEST_DATA_SUCCEEDED));</span>
<span class="nc" id="L181">        return getRecommendRuleVO;</span>
    }

    /**
     * 管理员计算相似度推荐算法
     * @param setAlgorithmDTO
     * @return
     */
    @Override
    public SetAlgorithmVO setAlgorithm(SetAlgorithmDTO setAlgorithmDTO){
<span class="nc" id="L191">        SetAlgorithmVO setAlgorithmVO = new SetAlgorithmVO();</span>
<span class="nc" id="L192">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L193">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L194">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L195">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>
<span class="nc" id="L196">        Long userId = (Long)tokenVerification.get(VerificationMapConstant.USERID.getStr());</span>

<span class="nc bnc" id="L198" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L199">            setAlgorithmVO.setResponse(resultVO);</span>
<span class="nc" id="L200">            return setAlgorithmVO;</span>
        }
<span class="nc" id="L202">        algorithmMapper.delete_all();</span>
<span class="nc" id="L203">        algorithmMapper.insert(userId,setAlgorithmDTO.getRule());</span>
<span class="nc" id="L204">        setAlgorithmVO.setResponse(new ResultVO(ResponseConstant.ADMIN_SET_RULE_SUCCESS));</span>

<span class="nc" id="L206">        return setAlgorithmVO;</span>
    }


    /**
     * 管理员查看相似度计算方法
     * @return
     */
    @Override
    public GetAlgorithmVO getAlgorithm(){
<span class="nc" id="L216">        GetAlgorithmVO getAlgorithmVO = new GetAlgorithmVO();</span>
<span class="nc" id="L217">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L218">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L219">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L220">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L222" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L223">            getAlgorithmVO.setResponse(resultVO);</span>
<span class="nc" id="L224">            return getAlgorithmVO;</span>
        }

//        getAlgorithmVO.setRule(algorithmMapper.get_algorithm_by_admin_id(1L));
<span class="nc" id="L228">        getAlgorithmVO.setRule(algorithmMapper.get_algorithm());</span>
<span class="nc" id="L229">        getAlgorithmVO.setResponse(new ResultVO(ResponseConstant.REQUEST_DATA_SUCCEEDED));</span>
<span class="nc" id="L230">        return getAlgorithmVO;</span>
    }

    /**
     * 查看报告可修改时间
     * @return
     */
    @Override
    public GetChangeablePeriodVO getChangeablePeriod(){
<span class="nc" id="L239">        GetChangeablePeriodVO getChangeablePeriodVO = new GetChangeablePeriodVO();</span>
<span class="nc" id="L240">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L241">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L242">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L243">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L245" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L246">            getChangeablePeriodVO.setResponse(resultVO);</span>
<span class="nc" id="L247">            return getChangeablePeriodVO;</span>
        }
<span class="nc" id="L249">        getChangeablePeriodVO.setChangeablePeriod(algorithmMapper.get_day().get(0));</span>
<span class="nc" id="L250">        getChangeablePeriodVO.setResponse(new ResultVO(ResponseConstant.REQUEST_DATA_SUCCEEDED));</span>
<span class="nc" id="L251">        return getChangeablePeriodVO;</span>
    }

    @Override
    public SetChangeablePeriodVO setChangeablePeriod(SetChangeablePeriodDTO setChangeablePeriodDTO){
<span class="nc" id="L256">        SetChangeablePeriodVO setChangeablePeriodVO = new SetChangeablePeriodVO();</span>
<span class="nc" id="L257">        Map&lt;String, Object&gt; tokenVerification =</span>
<span class="nc" id="L258">                parameterValidityVerification.tokenVerification(RoleConstant.ADMIN.getRole());</span>
<span class="nc" id="L259">        ResultVO resultVO = (ResultVO)tokenVerification.get(VerificationMapConstant.RESULTVO.getStr());</span>
<span class="nc" id="L260">        Long valid = (Long)tokenVerification.get(VerificationMapConstant.VALID.getStr());</span>

<span class="nc bnc" id="L262" title="All 2 branches missed.">        if(valid != BooleanValue.TRUE){</span>
<span class="nc" id="L263">            setChangeablePeriodVO.setResponse(resultVO);</span>
<span class="nc" id="L264">            return setChangeablePeriodVO;</span>
        }
<span class="nc" id="L266">        algorithmMapper.delete_day();</span>
<span class="nc" id="L267">        algorithmMapper.insert_day(setChangeablePeriodDTO.getChangeablePeriod());</span>
<span class="nc" id="L268">        setChangeablePeriodVO.setResponse(new ResultVO(ResponseConstant.REQUEST_DATA_SUCCEEDED));</span>
<span class="nc" id="L269">        return setChangeablePeriodVO;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>